@model HospitalManagementSystem.Models.Appointment

@{
    ViewData["Title"] = "Create Appointment";
    var patients = ViewBag.Patients as IEnumerable<HospitalManagementSystem.Models.Patient> ?? Enumerable.Empty<HospitalManagementSystem.Models.Patient>();
    var doctors = ViewBag.Doctors as IEnumerable<HospitalManagementSystem.Models.Doctor> ?? Enumerable.Empty<HospitalManagementSystem.Models.Doctor>();
}

@section PageBackground {
    <div class="appt-bg-fixed" aria-hidden="true"></div>
    <div class="appt-bg-overlay" aria-hidden="true"></div>
}


<style>
    :root { --header-height:70px; --footer-height:64px; --primary:#5b8df9; --secondary:#7b5cfb; --accent:#17c0b5;
            --grad-main:linear-gradient(135deg,#5b8df9,#7b5cfb); --grad-accent:linear-gradient(90deg,#17c0b5,#3aa0ff);
            --panel-bg:linear-gradient(145deg,rgba(255,255,255,0.90),rgba(255,255,255,0.76));
            --muted:#5c6672; --text:#243041; }
    [data-theme="dark"] :root { --panel-bg:linear-gradient(145deg,rgba(34,46,60,0.92),rgba(26,36,48,0.90)); --muted:#c2ced8; --text:#f3f7fa; }

    .appt-bg-fixed{position:fixed;top:var(--header-height);left:0;right:0;bottom:var(--footer-height);
        background-image:url('@Url.Content("~/images/dept.png")');background-size:cover;background-position:center;z-index:0;}
    .appt-bg-overlay{position:fixed;top:var(--header-height);left:0;right:0;bottom:var(--footer-height);
        background:linear-gradient(to bottom,rgba(255,255,255,0.30),rgba(255,255,255,0.08));z-index:1;pointer-events:none;}
    [data-theme="dark"] .appt-bg-overlay{background:linear-gradient(to bottom,rgba(0,0,0,0.55),rgba(0,0,0,0.35));}

    .form-wrapper{position:relative;z-index:2;max-width:860px;margin:0 auto;padding:32px 8px 60px;}
    .panel{background:var(--panel-bg);border:1px solid rgba(120,140,170,0.28);border-radius:32px;
        padding:54px 58px 62px;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
        box-shadow:0 28px 74px rgba(40,70,140,0.26);position:relative;overflow:hidden;animation:fadePanel .55s ease;}
    [data-theme="dark"] .panel{border:1px solid rgba(255,255,255,0.10);box-shadow:0 28px 74px rgba(0,0,0,0.70);}
    .panel::before{content:"";position:absolute;width:540px;height:540px;top:-250px;left:-250px;
        background:radial-gradient(circle at 55% 55%,rgba(91,141,249,0.28),transparent 70%);}
    .panel::after{content:"";position:absolute;width:480px;height:480px;bottom:-240px;right:-240px;
        background:radial-gradient(circle at 45% 45%,rgba(123,92,251,0.24),transparent 72%);}
    [data-theme="dark"] .panel::before{background:radial-gradient(circle at 55% 55%,rgba(91,141,249,0.20),transparent 72%);}
    [data-theme="dark"] .panel::after{background:radial-gradient(circle at 45% 45%,rgba(123,92,251,0.18),transparent 74%);}

    h1.title{font-size:2rem;font-weight:700;margin:0 0 14px;
        background:linear-gradient(90deg,#5b8df9,#7b5cfb);-webkit-background-clip:text;background-clip:text;color:transparent;}
    [data-theme="dark"] h1.title{background:linear-gradient(90deg,#d5e6ff,#eddfff);text-shadow:0 0 6px rgba(255,255,255,0.35),0 2px 10px rgba(0,0,0,0.65);}

    .subtitle{color:var(--muted);font-size:.92rem;margin-bottom:36px;}
    [data-theme="dark"] .subtitle{color:#d4dde5;}

    .form-label{font-weight:600;letter-spacing:.35px;color:var(--text);}
    [data-theme="dark"] .form-label{color:#f0f4f9;}

    .panel form .form-control,.panel form .form-select{
        background:rgba(255,255,255,0.82);border:1px solid rgba(120,140,170,0.35);transition:.25s;
    }
    [data-theme="dark"] .panel form .form-control,[data-theme="dark"] .panel form .form-select{
        background:rgba(48,62,82,0.80);border:1px solid rgba(255,255,255,0.12);color:#f0f4f9;
    }
    .panel form .form-control:focus,.panel form .form-select:focus{
        border-color:var(--primary);box-shadow:0 0 0 4px rgba(91,141,249,0.30);
        background:rgba(255,255,255,0.97);
    }
    [data-theme="dark"] .panel form .form-control:focus,[data-theme="dark"] .panel form .form-select:focus{
        background:rgba(54,68,88,0.96);box-shadow:0 0 0 4px rgba(91,141,249,0.50);
    }

    .actions{display:flex;justify-content:space-between;flex-wrap:wrap;gap:16px;margin-top:8px;}

    .btn-accent{background:var(--grad-accent);color:#fff;border:none;border-radius:18px;
        padding:14px 32px;font-weight:600;letter-spacing:.45px;box-shadow:0 16px 40px rgba(56,160,255,0.38);
        display:inline-flex;align-items:center;gap:.55rem;transition:.3s;}
    .btn-accent:hover{transform:translateY(-4px);box-shadow:0 26px 58px rgba(56,160,255,0.46);filter:brightness(.97);}
    .btn-soft{background:linear-gradient(145deg,rgba(255,255,255,0.90),rgba(236,242,255,0.88));border:1px solid rgba(120,140,170,0.35);
        color:var(--text);border-radius:18px;padding:14px 30px;font-weight:600;text-decoration:none;transition:.3s;}
    .btn-soft:hover{transform:translateY(-3px);background:linear-gradient(145deg,rgba(255,255,255,0.96),rgba(241,246,255,0.96));}
    [data-theme="dark"] .btn-soft{background:linear-gradient(145deg,rgba(46,60,78,0.90),rgba(38,50,66,0.88));border:1px solid rgba(255,255,255,0.12);color:#e9f2f9;}
    [data-theme="dark"] .btn-soft:hover{background:linear-gradient(145deg,rgba(54,68,88,0.96),rgba(44,58,76,0.94));}

    @@keyframes fadePanel{from{opacity:0;transform:translateY(18px);}to{opacity:1;transform:translateY(0);}}
    @@media (max-width:780px){.panel{padding:46px 38px 56px;}}
</style>

<div class="form-wrapper">
    <div class="panel">
        <h1 class="title">Schedule a New Appointment</h1>
        <div class="subtitle">Fill in the required details below to create a new appointment.</div>

        <form asp-action="Create" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

            <div class="mb-4">
                <label asp-for="AppointmentDate" class="form-label">
                    <i class="bi bi-calendar-event me-1"></i> Appointment Date &amp; Time
                </label>
                <input asp-for="AppointmentDate" class="form-control" type="datetime-local"/>
                <span asp-validation-for="AppointmentDate" class="text-danger"></span>
            </div>

            <div class="mb-4">
                <label asp-for="PatientId" class="form-label">
<div class="container mt-4">
    <h2 class="text-primary mb-4 fw-bold">
        🩺 Schedule a New Appointment
    </h2>

    <form asp-action="Create" method="post" class="shadow-sm p-4 rounded bg-light">
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

        <!-- Appointment Date -->
        <div class="mb-3">
            <label asp-for="AppointmentDate" class="form-label fw-semibold">
                <i class="bi bi-calendar-event me-1"></i> Appointment Date & Time
            </label>
            <input asp-for="AppointmentDate" class="form-control" type="datetime-local" />
            <span asp-validation-for="AppointmentDate" class="text-danger"></span>
        </div>

        <!-- Patient -->
        @if (User.IsInRole("Admin"))
        {
            <!-- Admin: show dropdown -->
            <div class="mb-3">
                <label asp-for="PatientId" class="form-label fw-semibold">
                    <i class="bi bi-person-fill me-1"></i> Select Patient
                </label>
                <select asp-for="PatientId" class="form-select">
                    <option disabled selected value="">-- Choose a patient --</option>
                    @foreach (var patient in patients)
                    {
                        <option value="@patient.Id">@patient.FullName</option>
                    }
                </select>
                <span asp-validation-for="PatientId" class="text-danger"></span>
            </div>

            <div class="mb-4">
                <label asp-for="DoctorId" class="form-label">
                    <i class="bi bi-person-badge-fill me-1"></i> Select Doctor
                </label>
                <select asp-for="DoctorId" class="form-select">
                    <option disabled selected value="">-- Choose a doctor --</option>
                    @foreach (var doctor in doctors)
                    {
                        <option value="@doctor.DoctorId">@doctor.FullName (@doctor.Specialization)</option>
                    }
                </select>
                <span asp-validation-for="DoctorId" class="text-danger"></span>
            </div>

            <div class="actions">
                <a asp-action="Index" class="btn-soft">
                    <i class="bi bi-arrow-left"></i> Back to List
                </a>
                <button type="submit" class="btn-accent">
                    <i class="bi bi-calendar-plus"></i> Schedule Appointment
                </button>
            </div>
        </form>
    </div>
        }
        else if (User.IsInRole("Patient"))
        {
            <!-- Patient: hidden field, auto-assigned -->
            <input type="hidden" asp-for="PatientId" />
            <p><strong>Patient:</strong> @User.Identity.Name</p>
        }

        <!-- Doctor Dropdown -->
        <div class="mb-4">
            <label asp-for="DoctorId" class="form-label fw-semibold">
                <i class="bi bi-person-badge-fill me-1"></i> Select Doctor
            </label>
            <select asp-for="DoctorId" class="form-select">
                <option disabled selected value="">-- Choose a doctor --</option>
                @foreach (var doctor in doctors)
                {
                    <option value="@doctor.DoctorId">@doctor.FullName (@doctor.Specialization)</option>
                }
            </select>
            <span asp-validation-for="DoctorId" class="text-danger"></span>
        </div>

        <!-- Submit Buttons -->
        <div class="d-flex justify-content-between">
            <a asp-action="Index" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to List
            </a>
            <button type="submit" class="btn btn-success">
                <i class="bi bi-calendar-plus"></i> Schedule Appointment
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
